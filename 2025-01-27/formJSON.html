<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form</title>
    <link rel="stylesheet" href="FormValidation.css" />
  </head>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: aliceblue;
      margin: 0;
      padding: 0;
    }

    #survey-form {
      background-color: #fff;
      border-radius: 8px;
      margin: 30px auto;
      padding: 20px;
      max-width: 800px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    #title {
      text-align: center;
      font-size: 1.8rem;
      margin-bottom: 10px;
      color: #333;
    }

    #description {
      text-align: center;
      margin-bottom: 20px;
      color: #555;
    }

    fieldset {
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
    }

    legend {
      font-weight: bold;
      color: #333;
    }

    label {
      font-weight: 500;
      display: inline-block;
    }
    .form-group {
      margin-bottom: 10px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    input[type="date"],
    select,
    textarea {
      margin: 5px 0;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
      width: 100%;
      box-sizing: border-box;
    }

    input[type="radio"],
    input[type="checkbox"] {
      margin-right: 10px;
    }

    button {
      background-color: red;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
      margin: 0 auto;
    }

    button:hover {
      background-color: rgb(188, 7, 7);
    }

    #submitBtn {
      text-align: center;
    }

    .error-message {
      color: red;
      font-size: 0.9rem;
      margin-top: 10px;
    }

    #files {
      margin: 15px 0;
      font-size: 1rem;
    }

    #output {
      margin: 20px auto;
      background-color: #f0f0f0;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      font-size: 1rem;
      color: #333;
      max-width: 800px;
      text-align: center;
    }
  </style>
  <body>
    <form name="Form" id="survey-form" onsubmit="return validate(event)">
      <h1 id="title">Application for Permission to Date My Daughter</h1>
      <p id="description">
        <b>Note:</b> Form must be completed at least 21 days prior to the date.
      </p>

      <!-- Personal Details -->
      <fieldset>
        <legend>Personal Details</legend>
        <div class="form-group">
          <label for="name">Name:</label>
          <input
            type="text"
            name="name"
            id="name"
            placeholder="Enter your name"
            onchange="validateName()"
            required
          />
          <div class="error-message" id="nameError"></div>
        </div>

        <div class="form-group">
          <label for="address">Address:</label>
          <input
            type="text"
            name="address"
            id="address"
            placeholder="Enter your address"
            onchange="validateAddress()"
            required
          />
          <div class="error-message" id="addressError"></div>
        </div>

        <div class="form-group">
          <label for="email">Email:</label>
          <input
            type="email"
            name="email"
            id="email"
            placeholder="Enter your email"
            required
          />
        </div>

        <div class="form-group">
          <label for="number">Phone Number:</label>
          <input
            type="tel"
            name="number"
            id="phone"
            placeholder="Enter 10-digit phone number"
            onchange="validatePhone()"
            required
          />
          <div class="error-message" id="phoneError"></div>
        </div>

        <div class="form-group">
          <label for="iq">IQ:</label>
          <input
            type="number"
            name="iq"
            id="iq"
            placeholder="Enter your IQ"
            onchange="validateIQ()"
          />
          <div class="error-message" id="iqError"></div>
        </div>

        <p>
          <label>Gender:</label><br />
          <input type="radio" name="gender" id="male" value="male" required />
          Male<br />
          <input type="radio" name="gender" id="female" value="female" />
          Female<br />
          <input type="radio" name="gender" id="other" value="other" /> Other
        </p>

        <label for="date">Date of Proposed Outing:</label>
        <input type="date" name="date" id="date" required />
      </fieldset>

      <!-- Checkbox Section -->
      <fieldset>
        <label for="requirement">Check All That Apply</label>
        <p>
          <input type="checkbox" id="ch1" onchange="validateCheckbox()" /> I
          have tattoos and/or piercings<br />
          <input type="checkbox" id="ch2" onchange="validateCheckbox()" /> I am
          more than 2 years older than your daughter<br />
          <input type="checkbox" id="ch3" onchange="validateCheckbox()" /> I own
          a panel van or V8 ute<br />
          <input
            type="checkbox"
            id="ch4"
            onchange="validateCheckbox()"
            checked
          />
          I work full-time<br />
          <input
            type="checkbox"
            id="ch5"
            onchange="validateCheckbox()"
            checked
          />
          My parents are rich<br />
          <input
            type="checkbox"
            id="ch6"
            onchange="validateCheckbox()"
            checked
          />
          The date is at a well-lit public location<br />
        </p>
        <div class="error-message" id="checkboxError"></div>
      </fieldset>

      <!-- Other details Section -->
      <fieldset>
        <legend>Other Details</legend>
        <label for="dropdown">Political Persuasion:</label>
        <select id="dropdown">
          <option value="left">Left Wing</option>
          <option value="right">Right Wing</option>
          <option value="conservative">Conservative</option>
          <option value="nazi">Nazi</option></select
        ><br />

        <label for="dropdown2">Education Level Completed:</label>
        <select id="dropdown2">
          <option value="university">University</option>
          <option value="college">College</option>
          <option value="secondary">High School</option>
          <option value="none">None</option>
        </select>
      </fieldset>

      <!-- Essay Section -->
      <fieldset>
        <legend>Essay Section</legend>
        <div>
          <p>In 50 words or more explain why you want to date my daughter</p>
          <textarea
            id="msg"
            name="user_message"
            rows="4"
            cols="50"
            placeholder="Enter Text Here"
            required
          ></textarea>
          <div class="error-message" id="essayError"></div>

          <div>
            <p>Please upload contact details for 2 references</p>
            <textarea
              id="msg2"
              name="user_message"
              rows="4"
              cols="50"
              placeholder="Enter Text Here"
            ></textarea>
          </div>
          <p>
            Upload Police Clearance Certificate, Bank Statement and Medical
            Certifiates here:
            <input type="file" id="files" name="files" multiple />
          </p>
        </div>
      </fieldset>

      <div id="submitBtn">
        <button type="submit" id="submit">Submit Application</button>
      </div>
    </form>

    <div id="output">
      <!-- Output will be displayed here -->
    </div>
    <script>
      // Validate Name
      function validateName() {
        const name = document.getElementById("name").value;
        const nameError = document.getElementById("nameError");
        if (name.length < 3 || name.length > 20) {
          nameError.textContent = "Name must be between 3 and 20 characters.";
          return false;
        }
        nameError.textContent = "";
        return true;
      }

      // Validate Address
      function validateAddress() {
        const address = document.getElementById("address").value;
        const addressError = document.getElementById("addressError");
        if (address.length < 4 || address.length > 20) {
          addressError.textContent =
            "Address must be between 4 and 20 characters.";
          return false;
        }
        addressError.textContent = "";
        return true;
      }

      // Validate Phone
      function validatePhone() {
        const phone = document.getElementById("phone").value;
        const phoneError = document.getElementById("phoneError");
        if (phone.length !== 10 || isNaN(phone)) {
          phoneError.textContent = "Phone number must be 10 digits.";
          return false;
        }
        phoneError.textContent = "";
        return true;
      }

      // Validate IQ
      function validateIQ() {
        const iq = document.getElementById("iq").value;
        const iqError = document.getElementById("iqError");
        if (iq && (iq < 50 || iq > 200)) {
          iqError.textContent = "IQ must be between 80 and 150.";
          return false;
        }
        iqError.textContent = "";
        return true;
      }

      // Validate Checkbox
      function validateCheckbox() {
        const checked = document.querySelector(
          'input[type="checkbox"]:checked'
        );
        const checkboxError = document.getElementById("checkboxError");
        if (!checked) {
          checkboxError.textContent = "Please select at least one option.";
          return false;
        }
        checkboxError.textContent = "";
        return true;
      }

      // Validate Essay
      function validateEssay() {
        const essay = document.getElementById("msg").value;
        const essayError = document.getElementById("essayError");
        if (essay.length < 50) {
          essayError.textContent = "Essay must be at least 50 characters long.";
          return false;
        }
        essayError.textContent = "";
        return true;
      }

      // Validate Entire Form
      async function validate(event) {
        event.preventDefault(); // Prevent default form submission

        const isNameValid = validateName();
        const isAddressValid = validateAddress();
        const isPhoneValid = validatePhone();
        const isIQValid = validateIQ();
        const isCheckboxValid = validateCheckbox();
        const isEssayValid = validateEssay();

        if (
          isNameValid &&
          isAddressValid &&
          isPhoneValid &&
          isIQValid &&
          isCheckboxValid &&
          isEssayValid
        ) {
          //Collect form data
          const formData = {
            name: document.getElementById("name").value,
            address: document.getElementById("address").value,
            email: document.getElementById("email").value,
            phone: document.getElementById("phone").value,
            iq: parseInt(document.getElementById("iq").value),
            gender: document.querySelector('input[name="gender"]:checked')
              .value,
            datOfProposal: document.getElementById("date").value,
            tattooPiercing: document.getElementById("ch1").checked,
            twoYearsOlder: document.getElementById("ch2").checked,
            ownsPanelVan: document.getElementById("ch3").checked,
            worksFullTime: document.getElementById("ch4").checked,
            parentsRich: document.getElementById("ch5").checked,
            dateLocation: document.getElementById("ch6").checked,
            politicalPersuasion: document.getElementById("dropdown").value,
            educationLevel: document.getElementById("dropdown2").value,
            datingReason: document.getElementById("msg").value,
            reference: document.getElementById("msg2").value,
          };

          console.log(JSON.stringify(formData));

          try {
            const response = await fetch(
              "https://api.jsonbin.io/v3/b/6795cca8e41b4d34e47ecc59",
              {
                method: "put",
                headers: {
                  "Content-Type": "application/json",
                  "X-Master-Key":
                    "$2a$10$DBt3TkaR/umJ4XwjdZoqnulcsF6Vz8nArNkHDIZeCUdtOi7Qprq/u",
                },
                body: JSON.stringify(formData),
              }
            );
            const data = await response.json();
            console.log(data);
            if (response.ok) {
              alert("Data recorded successfully!");
              console.log("Response Data:", data);
              fetchData();
              //document.getElementById("survey-form").reset();
            } else {
              alert("Failed to update data.");
              console.error("Error Response:", data);
            }
          } catch (error) {
            console.error("Error: ", error);
            alert("An error occurred while posting data.");
          }
        }
      }

      async function fetchData() {
        try {
          const response = await fetch(
            "https://api.jsonbin.io/v3/b/6795cca8e41b4d34e47ecc59",
            {
              method: "GET",
              headers: {
                "X-Master-Key":
                  "$2a$10$DBt3TkaR/umJ4XwjdZoqnulcsF6Vz8nArNkHDIZeCUdtOi7Qprq/u",
              },
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }

          const result = await response.json();
          console.log("Fetched Data:", result);

          // Clear the output div
          const outputDiv = document.getElementById("output");
          outputDiv.innerHTML = "";

          // Append data dynamically to the output div
          const data = result.record; // Assuming JSON Bin's structure contains record
          const item = document.createElement("h1");
          item.textContent = "OUTPUT:";
          outputDiv.appendChild(item);
          for (const key in data) {
            if (data.hasOwnProperty(key)) {
              const item = document.createElement("p");
              item.textContent = `${key}: ${data[key]}`;
              outputDiv.appendChild(item);
            }
          }
        } catch (error) {
          console.error("Error:", error);
          const errorMessage = document.createElement("p");
          errorMessage.textContent =
            "Failed to fetch data. Please check the console for details.";
          document.getElementById("output").appendChild(errorMessage);
        }
      }
    </script>
  </body>
</html>
